#!/bin/bash

# Script de Testes Interativos PWA
# Team Nascimento BJJ

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     ğŸ§ª Guia Interativo de Testes PWA                       â•‘"
echo "â•‘     Team Nascimento BJJ                                    â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âœ… Servidor rodando em: http://localhost:4173"
echo ""
echo "ğŸ“‹ Escolha um teste para comeÃ§ar:"
echo ""
echo "   1ï¸âƒ£  Verificar Service Worker & Manifest"
echo "   2ï¸âƒ£  Prompt de InstalaÃ§Ã£o (Install App)"
echo "   3ï¸âƒ£  Cache Storage"
echo "   4ï¸âƒ£  TESTE OFFLINE (Mais Importante!)"
echo "   5ï¸âƒ£  Pagamentos Offline"
echo "   6ï¸âƒ£  VÃ­deos Offline"
echo "   7ï¸âƒ£  NotificaÃ§Ãµes Push"
echo "   8ï¸âƒ£  Performance (Lighthouse)"
echo "   9ï¸âƒ£  Teste em Celular"
echo "   ğŸ”Ÿ  SincronizaÃ§Ã£o AutomÃ¡tica"
echo "   1ï¸âƒ£1ï¸âƒ£ Debugging Console"
echo "   1ï¸âƒ£2ï¸âƒ£ Verificar AtualizaÃ§Ãµes"
echo ""
echo "   ğŸ“– Abrir Guia Completo"
echo "   ğŸŒ Abrir App"
echo "   âŒ Sair"
echo ""

while true; do
    read -p "Escolha uma opÃ§Ã£o: " choice

    case $choice in
        1)
            echo ""
            echo "ğŸ” TESTE 1: Verificar Service Worker & Manifest"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Passos:"
            echo "  1. Abra DevTools: F12"
            echo "  2. VÃ¡ para aba: Application"
            echo "  3. Clique em: Manifest (no menu esquerdo)"
            echo ""
            echo "O que vocÃª deve ver:"
            echo "  âœ… Name: Team Nascimento BJJ"
            echo "  âœ… Start URL: /"
            echo "  âœ… Display: standalone"
            echo "  âœ… Icons: 4 Ã­cones listados"
            echo ""
            echo "TambÃ©m verifique Service Workers:"
            echo "  1. Application â†’ Service Workers"
            echo "  2. Status deve ser: Running (verde)"
            echo ""
            echo "Abra o app em uma nova aba: http://localhost:4173"
            echo ""
            ;;
        2)
            echo ""
            echo "ğŸ“² TESTE 2: Prompt de InstalaÃ§Ã£o (Install App)"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Passos:"
            echo "  1. Acesse: http://localhost:4173"
            echo "  2. Procure Ã­cone de instalaÃ§Ã£o:"
            echo "     - Chrome/Edge: Ãcone na barra de endereÃ§o"
            echo "     - Ou: Menu (â‹®) â†’ 'Instalar app' ou 'Install app'"
            echo "  3. Clique para instalar"
            echo ""
            echo "O que acontece:"
            echo "  âœ… Prompt de instalaÃ§Ã£o aparece"
            echo "  âœ… ApÃ³s confirmar: App abre em janela separada"
            echo "  âœ… Atalho criado na tela inicial"
            echo ""
            ;;
        3)
            echo ""
            echo "ğŸ’¾ TESTE 3: Cache Storage"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Passos:"
            echo "  1. DevTools: F12"
            echo "  2. Abra aba: Application"
            echo "  3. Menu esquerdo: Storage â†’ Cache Storage"
            echo ""
            echo "O que vocÃª deve ver:"
            echo "  âœ… google-fonts-cache"
            echo "  âœ… cdn-cache"
            echo "  âœ… api-cache"
            echo "  âœ… videos-cache"
            echo "  âœ… sw:.../sw.js (Service Worker cache)"
            echo ""
            echo "Clique em cada cache para ver o conteÃºdo armazenado!"
            echo ""
            ;;
        4)
            echo ""
            echo "ğŸŒ TESTE 4: MODO OFFLINE (MAIS IMPORTANTE!)"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Passos:"
            echo "  1. Acesse: http://localhost:4173"
            echo "  2. DevTools: F12"
            echo "  3. Aba: Network (no topo)"
            echo "  4. Procure checkbox 'Offline'"
            echo "     (Se nÃ£o ver, procure em 'No throttling')"
            echo "  5. MARQUE 'Offline' âœ“"
            echo "  6. Recarregue a pÃ¡gina: Ctrl + R"
            echo ""
            echo "O que deve acontecer:"
            echo "  âœ… PÃ¡gina CONTINUA funcionando!"
            echo "  âœ… Nenhum erro aparece"
            echo "  âœ… Pode navegar entre abas"
            echo ""
            echo "VERIFICAÃ‡Ã•ES:"
            echo "  ğŸ“Š Na aba Network, veja os requests"
            echo "     â†’ Procure por 'from cache' ou status 200"
            echo "  ğŸš« NÃ£o deve haver requests vermelhos (erros)"
            echo ""
            echo "Teste navegaÃ§Ã£o:"
            echo "  â˜ Clique em 'Dashboard'"
            echo "  â˜ Clique em 'Alunos'"
            echo "  â˜ Clique em 'Biblioteca'"
            echo "  â˜ Tudo deve funcionar!"
            echo ""
            ;;
        5)
            echo ""
            echo "ğŸ’³ TESTE 5: Pagamentos Offline"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "PrÃ©-requisito:"
            echo "  â€¢ VocÃª jÃ¡ integrou PaymentForm.vue em uma pÃ¡gina"
            echo ""
            echo "Passos:"
            echo "  1. Ative Modo Offline (DevTools â†’ Network â†’ Offline âœ“)"
            echo "  2. VÃ¡ para pÃ¡gina com formulÃ¡rio de pagamento"
            echo "  3. Preencha:"
            echo "     - Valor: 199.90"
            echo "     - Aluno: selecione algum"
            echo "     - MÃ©todo: CartÃ£o de CrÃ©dito"
            echo "  4. Clique: 'Confirmar Pagamento'"
            echo ""
            echo "O que deve aparecer:"
            echo "  âœ… Aviso amarelo: 'Modo Offline'"
            echo "  âœ… BotÃ£o muda para: 'Processando...'"
            echo "  âœ… NotificaÃ§Ã£o: 'Pagamento armazenado!'"
            echo "  âœ… Mensagem: 'SerÃ¡ sincronizado quando conectado'"
            echo ""
            echo "Verificar armazenamento:"
            echo "  1. DevTools â†’ Storage â†’ IndexedDB"
            echo "  2. Selecione: nascimento-bjj"
            echo "  3. Abra: payments"
            echo "  âœ… VocÃª deve ver sua entrada de pagamento!"
            echo ""
            echo "Sincronizar apÃ³s conectar:"
            echo "  1. Desmarque 'Offline' em Network"
            echo "  2. Recarregue a pÃ¡gina"
            echo "  3. Aguarde 2-3 segundos"
            echo "  âœ… NotificaÃ§Ã£o: 'Pagamento sincronizado!'"
            echo "  âœ… IndexedDB: entrada desaparece (foi pro servidor)"
            echo ""
            ;;
        6)
            echo ""
            echo "ğŸ¥ TESTE 6: VÃ­deos Offline"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "PrÃ©-requisito:"
            echo "  â€¢ VocÃª jÃ¡ integrou VideoLibraryOffline.vue em uma pÃ¡gina"
            echo ""
            echo "Passos:"
            echo "  1. ConexÃ£o ONLINE (desmarque Offline)"
            echo "  2. VÃ¡ para pÃ¡gina com biblioteca de vÃ­deos"
            echo "  3. Procure por um vÃ­deo"
            echo "  4. Clique botÃ£o: 'Baixar'"
            echo ""
            echo "Download em progresso:"
            echo "  1. DevTools â†’ Network"
            echo "  2. VocÃª vai ver arquivo .mp4 sendo baixado"
            echo "  âœ… Status: Em progresso..."
            echo "  3. ApÃ³s terminar: NotificaÃ§Ã£o 'VÃ­deo baixado!'"
            echo "  âœ… BotÃ£o muda para: 'Remover'"
            echo ""
            echo "Assistir offline:"
            echo "  1. Ative Modo Offline (Network â†’ Offline âœ“)"
            echo "  2. Clique: 'Assistir' no vÃ­deo"
            echo "  âœ… Player abre"
            echo "  âœ… VÃ­deo reproduz perfeitamente!"
            echo ""
            echo "Verificar Cache:"
            echo "  1. DevTools â†’ Storage â†’ Cache Storage"
            echo "  2. Abra: videos-cache"
            echo "  âœ… VocÃª deve ver o .mp4 armazenado"
            echo ""
            ;;
        7)
            echo ""
            echo "ğŸ”” TESTE 7: NotificaÃ§Ãµes Push"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Primeira vez:"
            echo "  1. Acesse http://localhost:4173"
            echo "  2. Navegador pode pedir: 'Permitir notificaÃ§Ãµes?'"
            echo "  3. Clique: 'Permitir' (nÃ£o bloqueie!)"
            echo ""
            echo "Se jÃ¡ bloqueou:"
            echo "  1. DevTools â†’ Application â†’ Manifest"
            echo "  2. Clique no botÃ£o ao lado de 'Notifications'"
            echo "  3. Selecione: 'Allow'"
            echo ""
            echo "Teste notificaÃ§Ãµes:"
            echo "  1. Realize alguma aÃ§Ã£o (ex: pagar, baixar vÃ­deo)"
            echo "  2. Verifique notificaÃ§Ã£o no canto da tela"
            echo "  âœ… Deve aparecer notificaÃ§Ã£o"
            echo ""
            echo "Ver notificaÃ§Ãµes no DevTools:"
            echo "  1. DevTools â†’ Application"
            echo "  2. Menu esquerdo: Service Workers"
            echo "  3. Em cima: 'Inspection' ou similar"
            echo "  4. VerÃ¡ lista de notificaÃ§Ãµes enviadas"
            echo ""
            ;;
        8)
            echo ""
            echo "ğŸ“Š TESTE 8: Performance (Lighthouse)"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Rodando Lighthouse:"
            echo "  1. Acesse http://localhost:4173"
            echo "  2. DevTools: F12"
            echo "  3. Procure aba: Lighthouse"
            echo "     (Se nÃ£o tiver, vÃ¡ em Menu (â‹®) â†’ More tools â†’ Lighthouse)"
            echo "  4. Selecione:"
            echo "     - Device: Mobile"
            echo "     - Category: Progressive Web App"
            echo "  5. Clique: 'Analyze page load'"
            echo "  6. Aguarde anÃ¡lise (30-60 segundos)"
            echo ""
            echo "Resultado esperado:"
            echo "  âœ… PWA Score: > 90 (ideal)"
            echo "  âœ… Performance: > 85"
            echo "  âœ… Accessibility: > 90"
            echo "  âœ… Best Practices: > 90"
            echo ""
            echo "Se score baixo:"
            echo "  â€¢ Podem faltar Ã­cones em public/"
            echo "  â€¢ Verifique console por erros"
            echo "  â€¢ Veja 'Opportunities' no relatÃ³rio"
            echo ""
            ;;
        9)
            echo ""
            echo "ğŸ“± TESTE 9: Teste em Dispositivo Celular"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "PrÃ©-requisito:"
            echo "  â€¢ Celular e PC na mesma rede WiFi"
            echo "  â€¢ Servidor rodando em http://localhost:4173"
            echo ""
            echo "Passo 1: Descobrir IP da sua mÃ¡quina"
            echo "  (No Windows CMD ou PowerShell)"
            echo "  $ ipconfig"
            echo ""
            echo "  Procure por:"
            echo "  'IPv4 Address . . . . . : 192.168.X.X'"
            echo ""
            echo "Passo 2: No celular"
            echo "  1. Abra navegador"
            echo "  2. Acesse: http://192.168.X.X:4173"
            echo "  (substitua o X pelo seu IP)"
            echo ""
            echo "Passo 3: Instalar app"
            echo "  ANDROID (Chrome):"
            echo "    â€¢ Menu (â‹®) â†’ Instalar app"
            echo "    â€¢ Confirme"
            echo "    â€¢ App aparece na tela inicial âœ…"
            echo ""
            echo "  iPHONE (Safari):"
            echo "    â€¢ Compartilhar (canto inf direito)"
            echo "    â€¢ Adicionar Ã  tela inicial"
            echo "    â€¢ Confirme"
            echo "    â€¢ App aparece como Ã­cone âœ…"
            echo ""
            echo "Passo 4: Testar offline"
            echo "  1. Ativa modo aviÃ£o âœˆï¸"
            echo "  2. Abre app"
            echo "  âœ… Deve funcionar completamente!"
            echo "  3. Desativa modo aviÃ£o"
            echo "  âœ… Dados sincronizam"
            echo ""
            ;;
        10)
            echo ""
            echo "ğŸ”„ TESTE 10: SincronizaÃ§Ã£o AutomÃ¡tica"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "CenÃ¡rio:"
            echo "  1. Ative Offline (Network â†’ Offline âœ“)"
            echo "  2. Realize aÃ§Ãµes (pagamentos, etc)"
            echo "  3. Dados ficam pendentes"
            echo "  4. Desative Offline"
            echo "  5. Dados sincronizam automaticamente"
            echo ""
            echo "Verificar sincronizaÃ§Ã£o:"
            echo "  1. DevTools â†’ Console"
            echo "  2. Desmarque 'Offline'"
            echo "  3. VocÃª deve ver logs como:"
            echo "     [Service Worker] Sincronizando pagamentos..."
            echo "     âœ… Pagamento sincronizado!"
            echo ""
            echo "  4. IndexedDB â†’ nascimento-bjj â†’ payments"
            echo "  âœ… Entradas desaparecem (foram para servidor)"
            echo ""
            echo "  5. Deve haver notificaÃ§Ã£o:"
            echo "     'Pagamento sincronizado com sucesso!'"
            echo ""
            ;;
        11)
            echo ""
            echo "ğŸ› TESTE 11: Debugging Console"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Verificar logs:"
            echo "  1. Acesse http://localhost:4173"
            echo "  2. DevTools: F12"
            echo "  3. Aba: Console"
            echo ""
            echo "VocÃª deve ver:"
            echo "  âœ… '[Service Worker] Instalando...'"
            echo "  âœ… '[Service Worker] Ativando...'"
            echo "  âœ… '[Service Worker] Carregado com sucesso!'"
            echo "  âœ… 'âœ… Service Worker registrado'"
            echo "  âœ… 'ğŸ“² Prompt de instalaÃ§Ã£o disponÃ­vel'"
            echo ""
            echo "NÃƒO deve haver:"
            echo "  âŒ Erros em vermelho"
            echo "  âŒ CORS errors"
            echo "  âŒ 404 Not Found"
            echo ""
            echo "Se tiver erros:"
            echo "  1. Anote mensagem de erro"
            echo "  2. Procure no arquivo correspondente"
            echo "  3. Verifique sintaxe"
            echo ""
            ;;
        12)
            echo ""
            echo "âš¡ TESTE 12: Verificar AtualizaÃ§Ãµes"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo ""
            echo "Sistema de updates automÃ¡ticos:"
            echo "  1. Acesse http://localhost:4173"
            echo "  2. DevTools â†’ Console"
            echo "  3. Recarregue pÃ¡gina (Ctrl + R)"
            echo "  4. VocÃª deve ver:"
            echo "     'Checking for updates...'"
            echo ""
            echo "Se hÃ¡ nova versÃ£o:"
            echo "  1. Service Worker detecta"
            echo "  2. Baixa em background"
            echo "  3. PrÃ³xima vez que abrir:"
            echo "     'New version available!'"
            echo "  4. Pode atualizar manualmente ou automÃ¡tico"
            echo ""
            echo "Testar atualizaÃ§Ãµes:"
            echo "  1. FaÃ§a uma mudanÃ§a no cÃ³digo"
            echo "  2. npm run build"
            echo "  3. Recarregue pÃ¡gina no navegador"
            echo "  4. Service Worker detecta mudanÃ§a"
            echo "  5. Oferece atualizar"
            echo ""
            ;;
        *)
            if [[ "$choice" == "guia" ]]; then
                echo ""
                echo "ğŸ“– Abrindo guia completo..."
                echo "Veja arquivo: TESTING_GUIDE.md"
                echo ""
            elif [[ "$choice" == "app" ]]; then
                echo ""
                echo "ğŸŒ Abrindo app no navegador..."
                echo "http://localhost:4173"
                echo ""
            elif [[ "$choice" == "exit" ]] || [[ "$choice" == "sair" ]]; then
                echo ""
                echo "ğŸ‘‹ AtÃ© logo! Boa sorte com os testes!"
                echo ""
                break
            else
                echo ""
                echo "âŒ OpÃ§Ã£o invÃ¡lida. Tente novamente."
                echo ""
            fi
            ;;
    esac
done
